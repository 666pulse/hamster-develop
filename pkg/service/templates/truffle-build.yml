version: 1.0
name: {{.Name}}
stages:
  git-clone:
    steps:
      - name: git-clone
        uses: git-checkout
        with:
          url: {{ .RepositoryUrl }}
          branch: main
  code-compile:
    needs:
      - git-clone
    steps:
      - name: code-compile
        run: |
          yarn install
          yarn compile
      - name: filter
        run: |
          mkdir -p build/artifacts
          cd contracts
          for i in `ls *.sol`;do
            if [ -e "../build/contracts/`echo $i|sed 's/\.sol//g'`.json" ]; then
              cp -R ../build/contracts/`echo $i|sed 's/\.sol//g'`.json ../build/artifacts
            fi
          done;

      - name: save artifactory
        uses: hamster-artifactory
        with:
          name: contract-meta.zip
          compress: false
          path: |
            build/artifacts/*.json
